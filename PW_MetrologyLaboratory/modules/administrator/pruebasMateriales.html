<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="../../imgs/Grammer_Logo.ico" type="image/x-icon">
    <title>Consultar una prueba</title>

    <!--Enlace de iconos: icons8, licencia con mención -->
    <link rel= "stylesheet" href= "https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css" >
    <!--Fuente -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!--Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="../../css/style.css">
    <!-- -Archivos de jQuery-->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body >
<!-- Modal NuevoMaterial-->
<div >
    <div class="modal-lg modal-dialog modal-dialog-centered modal-dialog-scrollable ">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="nuevoMateriallLabel">Agregar material</h5><br>
                <button type="button" class="btn-close" id="" data-bs-dismiss="modal" onclick="" aria-label="Close"></button>
            </div>
            <div class="modal-body row">
                <form method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <div class="help-block with-errors"></div>
                        <label for="descMaterialN" class="form-label">Descripción del material: </label>
                        <input type="text" name="descMaterialN" id="descMaterialN" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <div class="help-block with-errors"></div>
                        <label for="numParteN" class="form-label">Número de parte: </label>
                        <input id="numParteN" name="numParteN" type="text" class="form-control" placeholder="Número de parte*" required data-error="Por favor ingresa el número de parte">
                    </div>
                    <div class="mb-3">
                        <div class="help-block with-errors"></div>
                        <label for="imgMaterialN" class="form-label" >Imagen del material: </label>
                        <input type="file" placeholder="Imagen del material" class="form-control" onchange="plataformaModal()" id="imgMaterialN" name="imgMaterialN">
                    </div>
                    <div class="mb-3">
                        <div class="help-block with-errors"></div>
                        <label for="descMPlataformaN" class="form-label">Plataforma: </label>
                        <select class="form-control" id="descMPlataformaN" name="descMPlataformaN" required data-error="Por favor seleccione el cliente" >
                            <option value="">Seleccione una plataforma*</option>
                        </select>
                    </div>
                    <div class="row justify-content-end">
                        <div class="">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="">Close</button>
                            <button type="submit" class="btn btn-secondary" onclick="registrarMaterial()"><i class="las la-save"></i>Guardar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    const id = str => document.getElementById(str);
    function registrarMaterial(){
        var descMaterialN = id("descMaterialN");
        var numParteN = id("numParteN");
        var imgMaterialN = id("imgMaterialN");
        var descMPlataformaN = id("descMPlataformaN");

        const dataForm = new FormData();
        dataForm.append('descMaterialN', descMaterialN.value.trim());
        dataForm.append('numParteN', numParteN.value.trim());
        dataForm.append('imgMaterialN', imgMaterialN.files[0]);
        dataForm.append('descMPlataformaN', descMPlataformaN.value.trim());

        console.log("DataForm enviado:", dataForm); // Agrega esta línea para ver lo que estás enviando
        console.log("Valor de descMaterialN:", descMaterialN.value.trim());
        console.log("Valor de numParteN:", numParteN.value.trim());
        console.log("Valor de imgMaterialN:", imgMaterialN.files[0]); // imgMaterialN debería ser un elemento de tipo archivo
        console.log("Valor de descMPlataformaN:", descMPlataformaN.value.trim());

        fetch('https://arketipo.mx/Produccion/ML/PW_MetrologyLaboratory/dao/daoNuevoMaterial.php', {
            method: 'POST',
            body: dataForm
        }).then(function (response) {
                if (response.ok) { //respuesta
                    Swal.fire({
                        icon: "success",
                        title: "Material guardado con éxito",
                        showConfirmButton: false,
                        timer: 1500
                    });
                } else {
                    throw "Error en la llamada Ajax";
                }
            })
            .then(function (texto) {
                console.log(texto);
            })
            .catch(function (err) {
                console.log(err);
            });



        /*fetch('https://arketipo.mx/Produccion/ML/PW_MetrologyLaboratory/dao/daoNuevoMaterial.php', {
            method: 'POST',
            body: dataForm
        }).then(res => {
            console.log("Respuesta del servidor:", res);
            TablaAdminMateriales();
            if(!res.ok){
                console.log('Problem');
                return;
            }
            return res.json();
        })
            .then(data => {
                Swal.fire({
                    icon: "success",
                    title: "Your work has been saved",
                    showConfirmButton: false,
                    timer: 1500
                });
            })
            .catch(error =>{
                console.log(error);
            });*/


    }

    function TablaAdminMateriales(){
        $.getJSON('https://arketipo.mx/Produccion/ML/PW_MetrologyLaboratory/dao/daoConsultaMateriales.php', function (response) {
            var tabla = id("tablaMateriales");
            var tbody = tabla.getElementsByTagName("tbody")[0];

            // Limpiar contenido previo de la tabla
            tbody.innerHTML = '';

            // Iterar sobre los materiales y crear filas y celdas de tabla
            for (var j = 0; j < response.data.length; j++) {
                var fila = document.createElement("tr");

                var idMaterial = document.createElement("td");
                idMaterial.textContent = response.data[j].id_descripcion;
                fila.appendChild(idMaterial);

                var descripcionMaterial = document.createElement("td");
                descripcionMaterial.textContent = response.data[j].descripcionMaterial;
                fila.appendChild(descripcionMaterial);

                var numeroDeParte = document.createElement("td");
                numeroDeParte.textContent = response.data[j].numeroDeParte;
                fila.appendChild(numeroDeParte);

                var imgMaterial = document.createElement("td");
                var imagen = document.createElement("img");
                imagen.src = response.data[j].imgMaterial;
                imagen.classList.add("col-md-6", "mb-3", "ms-md-3", "rounded", "img-fluid","img-thumbnail");
                imgMaterial.appendChild(imagen);
                fila.appendChild(imgMaterial);

                var descripcionPlataforma = document.createElement("td");
                descripcionPlataforma.textContent = response.data[j].descripcionPlataforma;
                fila.appendChild(descripcionPlataforma);


                var acciones = document.createElement("td");
                // Botón de editar
                var btnEditar = document.createElement("button");
                btnEditar.textContent = "Editar";
                btnEditar.classList.add("btn", "btn-warning", "btnEditar");
                btnEditar.setAttribute("onclick", "editarMaterial('" +  response.data[j].id_descripcion + "')");

                // Botón de eliminar
                var btnEliminar = document.createElement("button");
                btnEliminar.textContent = "Desactivar";
                btnEliminar.classList.add("btn", "btn-danger", "btnDesactivar");
                btnEliminar.setAttribute("onclick", "desactivarMaterial('" +  response.data[j].id_descripcion + "')");
                // Agregar los botones al td
                acciones.appendChild(btnEditar);
                acciones.appendChild(btnEliminar);
                fila.appendChild(acciones);

                tbody.appendChild(fila);
            }
        });
    }

    function plataformaModal(){
        $.getJSON('https://arketipo.mx/Produccion/ML/PW_MetrologyLaboratory/dao/daoPlataformasT.php', function (data){
            var selectS = id("descMPlataformaN");
            selectS.innerHTML = "";

            var createOptionDef = document.createElement("option");
            createOptionDef.text = "Especifique la plataforma*";
            createOptionDef.value = "";
            selectS.appendChild(createOptionDef);

            for (var j = 0; j < data.data.length; j++) {
                var createOption = document.createElement("option");
                createOption.value = data.data[j].id_plataforma;
                createOption.text = data.data[j].descripcionPlataforma;
                selectS.appendChild(createOption);
            }
        });
    }

</script>


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
</body>
</html>